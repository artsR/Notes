{% extends "bootstrap/base.html" %}

{% block title %}
{% if title %}{{ title }} - Microblog{% else %}Welcome{% endif %}
{% endblock %}

{% block navbar %}
<nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="{{ url_for('main.index') }}">Microblog</a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li><a href="{{ url_for('main.index') }}">Home</a></li>
                <li><a href="{{ url_for('main.explore') }}">Explore</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                {% if current_user.is_anonymous %}
                <li><a href="{{ url_for('auth.login') }}">Sign In</a></li>
                <li><a href="{{ url_for('auth.register') }}">Sign Up</a></li>
                {% else %}
                <li><a href="{{ url_for('main.user', username=current_user.username) }}">Profile</a></li>
                <li><a href="{{ url_for('auth.logout') }}">Logout</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>
{% endblock %}

{% block content %}
<div class="container">
    {% with messages = get_flashed_messages() %}
    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-info" role="alert">{{ message }}</div>
        {% endfor %}
    {% endif %}
    {% endwith %}

    {# application content needs to be provided in the app_content block #}
    {% block app_content %}{% endblock %}
</div>
{% endblock %}

<!--to use JS 'moment.js' library (convert time/ timezone) all templates of the
application must include this libary.
I could use '<script>' tag that imports library OR
I can use 'Flask-Moment' function 'moment.include_moment()' that generates '<script>'-->
{% block scripts %}
    <!--'super()' preserves the content from the base template, otherwise any content
    defined for this block in the base template will be lost. -->
    {{ super() }}
    {{ moment.include_jquery() }}
    {{ moment.include_moment() }}

    <!--translation function replacing 'Translate' link with translated text: -->
    <script type="text/javascript">
        function translate(sourceElem, destElem, sourceLang, destLang) {
            // jQuery adding loading GIF in the place of 'Translate' link:
            $(destElem).html('<img src="{{ url_for('static', filename='loading.gif') }}">');

            // sending with jQuery 'POST' 'request' to the '/translate' URL:
            $.post('/translate', {
                // '$.post(URL)' works like 'Submit' button with the 'form'.
                // I can access outcome with 'request.form' (request.form['text']).
                text: $(sourceElem).text(),
                source_language: sourceLang,
                dest_language: destLang
                // below used 'promises' callback functions. It allows chain
                // the callbacks to the return value (this case: to the
                // return value of the '$.post()' )
            }).done(function(response){
                // '.done' syntax specifies what I want to do when the response is received.
                $(destElem).text(response['text'])
                                    // return value of the 'translate_text()' ('routes.py')
                                    // is 'jsonify()' - HTTP Response object (dict).
            }).fail(function() {
                // '.fail' syntax specifies what to do when the error ocurrs.
                $(destElem).text("{{ _('Error: Could not contact server.')}}");
            });
        }
    </script>
{% endblock %}
